---
title: "Bank Workflow"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(r2dii.dataraw)
library(r2dii.match)
library(r2dii.analysis)
```

## Matching

For analysis of a lending portfolio, `r2dii.analysis` picks up where `r2dii.match` leaves off. The following assumes that the `loanbook` has already been matched and validated against the `ald`. If this is not the case, please [click here for more info](https://2degreesinvesting.github.io/r2dii.match/).

```{r}
matched_loanbook <- match_name(loanbook = loanbook_demo, ald = ald_demo) %>%
  prioritize()
```

## Scenario Fair Shares

First, we must calculate the scenario fair shares. To do so:

```{r}
scenario_with_fair_shares <- scenario_demo %>% 
  add_fair_share(start_year = 2020)
```

With the scenario fair shares calculated, we can join the `matched_loanbook`, `ald` and `scenario`:

```{r}
join_portfolio_ald_scenario(
  match_result = matched_loanbook,
  ald = ald_demo,
  scenario = scenario_with_fair_shares
)
```
