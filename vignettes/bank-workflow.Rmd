---
title: "Bank Workflow"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(r2dii.dataraw)
library(r2dii.match)
library(r2dii.analysis)
```

## Matching

For analysis of a lending portfolio, `r2dii.analysis` picks up where `r2dii.match` leaves off. The following assumes that the `loanbook` has already been matched and validated against the `ald`. If this is not the case, please [click here for more info](https://2degreesinvesting.github.io/r2dii.match/).

```{r}
path <- system.file("extdata", "valid_matches.csv", package = "r2dii.analysis")
valid_matches <- readr::read_csv(path)
```

## Scenario Fair Shares

First, we must calculate the scenario fair shares. To do so:

```{r}
scenario_with_fair_shares <- scenario_demo %>% 
  add_fair_share_columns(start_year = 2020)
```

With the scenario fair shares calculated, we can join the `valid_matches`, `ald` and `scenario`:

```{r}
valid_matches %>% 
  join_ald_scenario(
    ald = ald_demo, 
    scenario = scenario_with_fair_shares
  )
```
