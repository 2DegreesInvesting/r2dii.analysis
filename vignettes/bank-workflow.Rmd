---
title: "Bank Workflow"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(r2dii.data)
library(r2dii.match)
library(r2dii.analysis)
```

## Matching

For analysis of a lending portfolio, `r2dii.analysis` picks up where `r2dii.match` leaves off. The following assumes that the `loanbook` has already been matched and validated against the `ald` (how to [validate matches](https://2degreesinvesting.github.io/r2dii.match/articles/r2dii.match.html#validate-matches)).

```{r}
valid_matches <- match_name(loanbook_demo, ald_demo) %>% 
  # WARNING: Remember to validate the output of match_name() before prioritize()
  prioritize()

valid_matches
```

## Scenario Fair Shares

We can now join the datasets `ald` and `scenario`, then add fare share columns.

```{r}
valid_matches %>% 
  join_ald_scenario(ald = ald_demo, scenario = r2dii.scenario::scenario_demo) %>% 
  r2dii.scenario::add_market_share_columns(start_year = 2020)
```
