---
title: "Bank Workflow"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(r2dii.dataraw)
library(r2dii.match)
library(r2dii.analysis)
```

## Matching

For analysis of a lending portfolio, `r2dii.analysis` picks up where `r2dii.match` leaves off. The following assumes that the `loanbook` has already been matched and validated against the `ald` (how to [validate matches](https://2degreesinvesting.github.io/r2dii.match/articles/r2dii.match.html#validate-matches)).

```{r}
valid_matches <- match_name(loanbook_demo, ald_demo) %>% 
  # WARNING: Remember to validate the output of match_name() before prioritize()
  prioritize()

valid_matches
```

## Scenario Fair Shares

First, we must calculate the scenario fair shares. To do so:

```{r}
scenario_with_fair_shares <- scenario_demo %>% 
  add_fair_share_columns(start_year = 2020)
```

With the scenario fair shares calculated, we can join the `valid_matches`, `ald` and `scenario`:

```{r}
valid_matches %>% 
  join_ald_scenario(
    ald = ald_demo, 
    scenario = scenario_with_fair_shares
  )
```
