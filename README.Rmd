---
output: github_document 
---
<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# r2dii.analysis <a href='https://github.com/2DegreesInvesting/r2dii.analysis'><img src='https://imgur.com/A5ASZPE.png' align='right' height='43' /></a>

<!-- badges: start -->
[![Lifecycle: maturing](https://img.shields.io/badge/lifecycle-maturing-blue.svg)](https://www.tidyverse.org/lifecycle/#maturing)
[![CRAN status](https://www.r-pkg.org/badges/version/r2dii.analysis)](https://CRAN.R-project.org/package=r2dii.analysis)
[![Codecov test coverage](https://codecov.io/gh/2degreesinvesting/r2dii.analysis/branch/master/graph/badge.svg)](https://codecov.io/gh/2degreesinvesting/r2dii.analysis?branch=master)
[![R build status](https://github.com/2DegreesInvesting/r2dii.analysis/workflows/R-CMD-check/badge.svg)](https://github.com/2DegreesInvesting/r2dii.analysis/actions)
[![R build status](https://github.com/2degreesinvesting/r2dii.analysis/workflows/R-CMD-check/badge.svg)](https://github.com/2degreesinvesting/r2dii.analysis/actions)
<!-- badges: end -->

These tools help you to assess if a financial portfolio aligns with climate
goals. They summarize key metrics attributed to the portfolio (e.g.
production, emission factors), and calculate targets based on climate
scenarios. They implement in R the last step of the free software 'PACTA'
(Paris Agreement Capital Transition Assessment;
<https://2degrees-investing.org/>). Financial institutions use 'PACTA' to
study how their capital allocation impacts the climate.

## Installation

Install the development version of r2dii.analysis with:

```r
# install.packages("devtools")

devtools::install_github("2DegreesInvesting/r2dii.analysis")
```

## Example

* Use `library()` to attach the packages you need.

```{r}
library(r2dii.data)
library(r2dii.match)
library(r2dii.analysis)
```

* Use `r2dii.match::match_name()` to identify matches between your loanbook and the asset level data.

```{r}
matched <- match_name(loanbook_demo, ald_demo) %>%
  prioritize()
```

### Add Scenario Targets

* Use `target_sda()` to calculate SDA targets of CO2 emissions.

```{r}
matched %>%
  target_sda(
    ald = ald_demo,
    co2_intensity_scenario = co2_intensity_scenario_demo
  )
```

* Use `target_market_share` to calculate market-share scenario targets at the portfolio level:

```{r}
matched %>%
  target_market_share(
    ald = ald_demo,
    scenario = scenario_demo_2020,
    region_isos = region_isos_demo
  )
```

* Or at the company level:

```{r}
matched %>%
  target_market_share(
    ald = ald_demo,
    scenario = scenario_demo_2020,
    region_isos = region_isos_demo,
    by_company = TRUE
  )
```

### Utility Functions

The `target_*()` functions provide shortcuts for common operations. They wrap some utility functions that you may also use directly:

* Use `join_ald_scenario()` to join a matched dataset to the relevant 
scenario data, and to pick assets in the relevant regions. 

```{r}
loanbook_joined_to_ald_scenario <- matched %>%
  join_ald_scenario(
    ald = ald_demo,
    scenario = scenario_demo_2020,
    region_isos = region_isos_demo
  )
```

* Use `summarize_weighted_production()` with different grouping arguments to 
calculate scenario-targets:

```{r}
# portfolio level
loanbook_joined_to_ald_scenario %>%
  summarize_weighted_production(scenario, tmsr, smsp, region)

# company level
loanbook_joined_to_ald_scenario %>%
  summarize_weighted_production(scenario, tmsr, smsp, region, name_ald)
```
