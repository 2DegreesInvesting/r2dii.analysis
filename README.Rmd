---
output: github_document 
---
<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# r2dii.analysis <a href='https://github.com/2DegreesInvesting/r2dii.analysis'><img src='https://imgur.com/A5ASZPE.png' align='right' height='43' /></a>

<!-- badges: start -->
[![lifecycle](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![CRAN status](https://www.r-pkg.org/badges/version/r2dii.analysis)](https://CRAN.R-project.org/package=r2dii.analysis)
[![Codecov test coverage](https://codecov.io/gh/2degreesinvesting/r2dii.analysis/branch/master/graph/badge.svg)](https://codecov.io/gh/2degreesinvesting/r2dii.analysis?branch=master)
[![R build status](https://github.com/2DegreesInvesting/r2dii.analysis/workflows/R-CMD-check/badge.svg)](https://github.com/2DegreesInvesting/r2dii.analysis/actions)
[![R build status](https://github.com/2degreesinvesting/r2dii.analysis/workflows/R-CMD-check/badge.svg)](https://github.com/2degreesinvesting/r2dii.analysis/actions)
<!-- badges: end -->

Warning:

> An experimental package is in the very early stages of development. The API will be changing frequently as we rapidly iterate and explore variations in search of the best fit. Experimental packages will make API breaking changes without deprecation, so you are generally best off waiting until the package is more mature before you use it.

-- <https://www.tidyverse.org/lifecycle/#experimental>

These tools implement in R a fundamental part of
the software PACTA (Paris Agreement Capital Transition Assessment),
which is a free tool that calculates the alignment between financial
portfolios and climate scenarios (<https://2degrees-investing.org/>).
Financial institutions use PACTA to study how their capital
allocation impacts the climate. This package provides a suite of metrics
and analysis tools commonly used for climate scenario analysis. For more 
information visit <https://2degrees-investing.org/>.

## Installation

Install the development version of r2dii.analysis with:

```r
# install.packages("devtools")

devtools::install_github("2DegreesInvesting/r2dii.analysis")
```

## Example

* Use `library()` to attach the packages you need.

```{r}
library(r2dii.data)
library(r2dii.match)
library(r2dii.analysis)
```

* Use `r2dii.match::match_name()` to identify matches between your loanbook and the asset level data.

```{r}
matched <- match_name(loanbook_demo, ald_demo) %>%
  prioritize()
```

* Use `target_sda()` to calculate SDA targets of CO2 emissions.

```{r}
target_sda(matched, ald_demo, co2_intensity_scenario_demo)
```

* Use `join_ald_scenario()` to join the matched dataset to the relevant 
scenario data, and to pick assets in the relevant regions. 

```{r}
loanbook_joined_to_ald_scenario <- matched %>% 
  join_ald_scenario(
    ald = ald_demo, 
    scenario = scenario_demo_2020, 
    region_isos = region_isos_demo
  )
```

* Use `summarize_company_production()` then `target_fair_share_company()` to calculate scenario-targets for each company.

```{r}
loanbook_joined_to_ald_scenario %>% 
  summarize_company_production() %>% 
  target_fair_share_company()
```

* Use `summarize_portfolio_production()` then `add_portfolio_target()` to calculate scenario-targets for the whole portfolio:

```{r}
loanbook_joined_to_ald_scenario %>% 
  summarize_portfolio_production() %>% 
  add_portfolio_target()
```
